<!--
  Copyright (c) 2006-2013, JGraph Ltd
  
  Folding example for mxGraph. This example demonstrates
  using a layout to implement a nested group structure.
-->
<html>

<head>
    <title>Hierarchical example for mxGraph</title>

    <!-- Sets the basepath for the library if not in same directory -->
    <script type="text/javascript">
        mxBasePath = 'mxgraph';
    </script>

    <!-- Loads and initializes the library -->
    <script type="text/javascript" src="mxClient.js"></script>

    <!-- Example code -->
    <script type="text/javascript">
        var graph;
        // Program starts here. Creates a sample graph in the
        // DOM node with the specified ID. This function is invoked
        // from the onLoad event handler of the document (see below).
        function main(container) {
            // Checks if the browser is supported
            if (!mxClient.isBrowserSupported()) {
                // Displays an error message if the browser is not supported.
                mxUtils.error('Browser is not supported!', 200, false);
            } else {
                // Enables crisp rendering of rectangles in SVG
                mxConstants.ENTITY_SEGMENT = 20;

                // Creates the graph inside the given container
                graph = new mxGraph(container);

                // Disables global features
                graph.collapseToPreferredSize = false;
                graph.constrainChildren = true;
                graph.cellsSelectable = false;
                graph.extendParentsOnAdd = false;
                graph.extendParents = true;
                graph.border = 10;

                graph.getModel().beginUpdate();
                try {
                    mkGraphWithGroups();
                } finally {
                    graph.getModel().endUpdate();
                    graph.setCellsMovable(false);
                }
            }
        }

        mkGraphWithGroups = () => {
            main = graph.insertVertex(graph.getDefaultParent(), null, 'main', 0, 0, 200, 200);
            mainBackup = graph.insertVertex(graph.getDefaultParent(), null, 'mainBackup', 0, 0, 200, 200);
            game = graph.insertVertex(graph.getDefaultParent(), null, 'game', 0, 0, 200, 200);
            vCD = graph.insertVertex(graph.getDefaultParent(), null, 'player', 0, 0, 200, 200);

            vDE = graph.insertVertex(graph.getDefaultParent(), 'vDE', 'vDE', 0, 0, 50, 200);

            graph.insertEdge(graph.getDefaultParent(), null, '', main, game);
            graph.insertEdge(graph.getDefaultParent(), null, '', mainBackup, game);
            graph.insertEdge(graph.getDefaultParent(), null, '', game, vCD);
            graph.insertEdge(graph.getDefaultParent(), null, '', game, vDE);

            layoutGraph(graph.getDefaultParent());

            v1 = graph.insertVertex(vDE, null, 'v1', 10, 0, 75, 50);
            v2 = graph.insertVertex(vDE, null, 'startVeryLongVeryLongstartVeryLongVeryLongstartVeryLongVeryLong',
                10,
                0, 75, 50);

            var v2G = v2.getGeometry();
            var vDEG = vDE.getGeometry();
            var v2Gp = graph.getPreferredSizeForCell(v2);
            console.log(v2Gp);
            v2G.width = v2Gp.width + 20;
            vDEG.width = v2G.width + 20;

            //layoutColumn(vDE);

            layoutGraph(graph.getDefaultParent());

            layoutColumn(vDE);
        };

        layoutGraph = objects => {
            let direction = objects.value && objects.value === 'vCD' ? mxConstants.DIRECTION_NORTH : mxConstants
                .DIRECTION_WEST;

            layout = new mxHierarchicalLayout(graph, direction);

            graph.getModel().beginUpdate();
            try {
                layout.execute(objects);
            } finally {
                graph.getModel().endUpdate();
            }
        };

        layoutColumn = objects => {
            layout = new mxStackLayout(graph, false, 10);

            graph.getModel().beginUpdate();
            try {
                layout.execute(objects);
            } finally {
                graph.getModel().endUpdate();
            }
        }
    </script>
</head>

<!-- Page passes the container for the graph to the program -->

<body onload="main(document.getElementById('graphContainer'))">
    <!-- Creates a container for the graph with a grid wallpaper -->
    <div id="graphContainer"></div>
</body>

</html>